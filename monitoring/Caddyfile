matrix.thebuildist.com {
    # Serve health check JSON
    handle /health.json {
        root * /var/www/health
        file_server
    }

    # Handle .well-known paths specifically
    handle /.well-known/matrix/client {
        respond `{"m.homeserver": {"base_url": "https://matrix.thebuildist.com"}}` 200
    }

    handle /.well-known/matrix/server {
        respond `{"m.server": "matrix.thebuildist.com:443"}` 200
    }

    # Main reverse proxy for everything else (including /_matrix/*)
    reverse_proxy localhost:6167
}
